<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quiz | LearnOnline</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <link href="css/styles.css" rel="stylesheet">
  <style>
    .option-selected { background: #e7f3ff; }
    .disabled { pointer-events: none; opacity: 0.6; }
    .question-progress { margin-bottom: 1rem; }
    .feedback { font-weight: 500; margin-top: 8px; }
    .feedback.correct { color: #198754; }
    .feedback.incorrect { color: #dc3545; }
    .quiz-image {
      max-width: 100%; max-height: 160px; object-fit: cover; border-radius: 8px; margin-bottom: 10px;
    }
    .review-star {
      color: #ffc107;
      font-size: 1.5rem;
      cursor: pointer;
      transition: color 0.2s;
    }
    .review-star.inactive {
      color: #e4e5e9;
    }
    .review-list {
      max-height: 260px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
    <div class="container">
      <a class="navbar-brand" href="index.html">LearnOnline</a>
      <div>
        <a class="btn btn-light" href="dashboard.html">My Dashboard</a>
      </div>
    </div>
  </nav>
  <div class="container my-5">
    <div class="row mb-4">
      <div class="col">
        <h2><i class="fa fa-clipboard-list text-primary"></i> Quiz: Python Basics</h2>
      </div>
      <div class="col text-end">
        <span class="badge bg-secondary p-2 fs-5" id="timer"><i class="fa fa-clock"></i> Time: 10:00</span>
        <span class="badge bg-info p-2 fs-5" id="score"><i class="fa fa-star"></i> Score: 0</span>
      </div>
    </div>
    <div id="quiz-area"></div>
    <div id="result-area" class="mt-4"></div>

    <!-- Review System -->
    <div class="mt-5">
      <h4 class="mb-3">Quiz Reviews</h4>
      <form id="reviewForm" class="mb-3">
        <div class="mb-2">
          <span id="reviewStars">
            <i class="fa fa-star review-star inactive" data-value="1"></i>
            <i class="fa fa-star review-star inactive" data-value="2"></i>
            <i class="fa fa-star review-star inactive" data-value="3"></i>
            <i class="fa fa-star review-star inactive" data-value="4"></i>
            <i class="fa fa-star review-star inactive" data-value="5"></i>
          </span>
        </div>
        <div class="mb-2">
          <textarea class="form-control" id="reviewText" rows="2" placeholder="Write your review..."></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Submit Review</button>
      </form>
      <div class="review-list" id="reviewList"></div>
    </div>
  </div>
  <footer class="bg-primary text-light text-center py-3 mt-5">
    &copy; 2025 LearnOnline. All rights reserved.
  </footer>
  <script>
    // Enhanced Quiz Data (same as previously enhanced version)
    const questions = [
      {
        q: "What is the correct way to declare a variable in Python?",
        img: "https://cdn.pixabay.com/photo/2017/01/10/19/05/python-1977800_1280.png",
        options: [
          "var x = 10",
          "x = 10",
          "int x = 10"
        ],
        answer: 1,
        feedback: [
          "Incorrect. 'var' is not used in Python.",
          "Correct! Python does not require a keyword for variable declaration.",
          "Incorrect. Python does not require you to specify types."
        ]
      },
      {
        q: "Which of these is a valid function definition in Python?",
        img: "",
        options: [
          "function myFunc():",
          "def myFunc():",
          "func myFunc()"
        ],
        answer: 1,
        feedback: [
          "Incorrect. 'function' is not a Python keyword.",
          "Correct! 'def' is used to define functions.",
          "Incorrect. 'func' is not valid in Python."
        ]
      },
      {
        q: "What does 'print(\"Hello\")' output?",
        img: "",
        options: [
          "Hello",
          "print(\"Hello\")",
          "Nothing"
        ],
        answer: 0,
        feedback: [
          "Correct! The output is simply 'Hello'.",
          "Incorrect. Python executes the print statement.",
          "Incorrect. The print statement displays its argument."
        ]
      },
      {
        q: "Which of the following is a Python list?",
        img: "https://cdn.pixabay.com/photo/2016/03/31/20/11/array-1297096_1280.png",
        options: [
          "{1, 2, 3}",
          "[1, 2, 3]",
          "(1, 2, 3)"
        ],
        answer: 1,
        feedback: [
          "Incorrect. Curly braces create a set.",
          "Correct! Square brackets denote lists.",
          "Incorrect. Parentheses create a tuple."
        ]
      },
      {
        q: "How do you insert COMMENTS in Python code?",
        img: "",
        options: [
          "// This is a comment",
          "# This is a comment",
          "/* This is a comment */"
        ],
        answer: 1,
        feedback: [
          "Incorrect. '//' is used in languages like JavaScript or Java.",
          "Correct! Use '#' for comments in Python.",
          "Incorrect. '/* ... */' is not valid in Python."
        ]
      }
    ];

    let current = 0;
    let selected = Array(questions.length).fill(null);
    let score = 0;
    let quizSubmitted = false;

    // Timer
    let totalSeconds = 600;
    let timerInterval = setInterval(function() {
      if (totalSeconds <= 0) {
        clearInterval(timerInterval);
        submitQuiz();
        document.getElementById('timer').innerText = "Time: 00:00";
        return;
      }
      totalSeconds--;
      let min = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
      let sec = String(totalSeconds % 60).padStart(2, '0');
      document.getElementById('timer').innerText = `Time: ${min}:${sec}`;
    }, 1000);

    function renderQuiz() {
      let q = questions[current];
      let area = document.getElementById('quiz-area');
      let disabled = quizSubmitted ? "disabled" : "";
      let html = `
        <div class="card shadow p-4 mb-3 ${disabled}">
          <div class="question-progress text-primary">
            <strong>Question ${current + 1}</strong> of ${questions.length}
          </div>
          ${q.img ? `<img class="quiz-image" src="${q.img}" alt="Question image">` : ""}
          <h5 class="mb-3">${q.q}</h5>
          <div>`;
      q.options.forEach((opt, i) => {
        html += `
        <div class="form-check mb-2">
          <input class="form-check-input" type="radio" name="q${current}" id="q${current}a${i}" ${selected[current] === i ? "checked" : ""} onchange="selectOption(${i})" ${disabled}>
          <label class="form-check-label" for="q${current}a${i}">${opt}</label>
          ${
            quizSubmitted && selected[current] === i
              ? `<div class="feedback ${selected[current] === q.answer ? "correct" : "incorrect"}">${q.feedback[i]}</div>`
              : ""
          }
        </div>`;
      });
      html += `</div>
      <div class="mt-4 d-flex justify-content-between">`;
      html += `<button class="btn btn-outline-secondary" onclick="prevQ()" ${current === 0 ? "disabled" : ""} ${disabled}><i class="fa fa-arrow-left"></i> Previous</button>`;
      if(current < questions.length - 1) {
        html += `<button class="btn btn-primary" onclick="nextQ()" ${disabled} ${selected[current] === null ? "disabled" : ""}>Next <i class="fa fa-arrow-right"></i></button>`;
      } else {
        html += `<button class="btn btn-success" onclick="submitQuiz()" id="submitBtn" ${disabled} ${selected[current] === null ? "disabled" : ""}><i class="fa fa-paper-plane"></i> Submit Quiz</button>`;
      }
      html += `</div></div>`;
      area.innerHTML = html;
      updateScore();
    }

    window.selectOption = function(i) {
      if(quizSubmitted) return;
      selected[current] = i;
      renderQuiz();
    };

    window.nextQ = function() {
      if(current < questions.length - 1) {
        current++;
        renderQuiz();
      }
    };

    window.prevQ = function() {
      if(current > 0) {
        current--;
        renderQuiz();
      }
    };

    function updateScore() {
      let sc = 0;
      for(let i=0; i<questions.length; i++) {
        if(selected[i] === questions[i].answer) sc++;
      }
      document.getElementById('score').innerText = `Score: ${sc}`;
    }

    window.submitQuiz = submitQuiz;
    function submitQuiz() {
      if(quizSubmitted) return;
      quizSubmitted = true;
      clearInterval(timerInterval);
      let sc = 0;
      for(let i=0; i<questions.length; i++) {
        if(selected[i] === questions[i].answer) sc++;
      }
      document.getElementById('score').innerText = `Score: ${sc}`;
      document.getElementById('quiz-area').classList.add('disabled');
      let res = `<div class="alert alert-info"><strong>Quiz Submitted!</strong> Your score is ${sc} out of ${questions.length}.</div>`;
      document.getElementById('result-area').innerHTML = res;
      renderQuiz();
    }

    // Review System
    let reviewStars = document.querySelectorAll('#reviewStars .review-star');
    let selectedRating = 0;
    let reviews = JSON.parse(localStorage.getItem('quizReviews') || '[]');

    function renderReviews() {
      const list = document.getElementById('reviewList');
      if (reviews.length === 0) {
        list.innerHTML = '<p class="text-muted">No reviews yet. Be the first!</p>';
        return;
      }
      list.innerHTML = reviews.map(r => `
        <div class="border-bottom pb-2 mb-2">
          <span>
            ${'<i class="fa fa-star review-star"></i>'.repeat(r.rating)}
            ${'<i class="fa fa-star review-star inactive"></i>'.repeat(5 - r.rating)}
          </span>
          <p class="mb-1">${r.text}</p>
          <div class="text-muted small"><i class="fa fa-user"></i> Learner, ${r.date}</div>
        </div>
      `).join('');
    }

    function setStarHover(rating) {
      reviewStars.forEach((star, idx) => {
        star.classList.toggle('inactive', idx >= rating);
      });
    }

    function resetStars() {
      setStarHover(selectedRating);
    }

    // Initial render
    renderQuiz();
    renderReviews();

    // Review Event Listeners
    reviewStars = document.querySelectorAll('#reviewStars .review-star');
    reviewStars.forEach(star => {
      star.addEventListener('mouseenter', e => setStarHover(Number(star.dataset.value)));
      star.addEventListener('mouseleave', resetStars);
      star.addEventListener('click', e => {
        selectedRating = Number(star.dataset.value);
        resetStars();
      });
    });

    document.getElementById('reviewForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const text = document.getElementById('reviewText').value.trim();
      if (selectedRating === 0 || !text) return;
      const review = {
        rating: selectedRating,
        text,
        date: new Date().toLocaleDateString()
      };
      reviews.unshift(review);
      localStorage.setItem('quizReviews', JSON.stringify(reviews));
      document.getElementById('reviewText').value = '';
      selectedRating = 0;
      resetStars();
      renderReviews();
    });
  </script>
</body>
</html>